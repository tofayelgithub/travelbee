{% extends 'profile/base.html' %} {% block profile %}{% load static %}

<div class="space-y-6">
    <div class="bg-white shadow px-4 py-5 sm:rounded-lg sm:p-6">
        <div class="md:grid md:grid-cols-3 md:gap-6">
            <div class="md:col-span-1">
                <h3 class="text-lg font-medium leading-6 text-gray-900">
                    Account Information
                </h3>
            </div>
            <div class="mt-5 md:mt-0 md:col-span-2">
                <form class="space-y-6" method="POST">
                    {% csrf_token %}
                    <input
                        type="text"
                        name="action"
                        value="updateUser"
                        hidden
                    />
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="">
                            <label
                                for="username"
                                class="block text-sm font-medium text-gray-700"
                            >
                                Username
                            </label>
                            <div class="mt-1 flex rounded-md shadow-sm">
                                <span
                                    class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 text-sm"
                                >
                                    @
                                </span>
                                <input
                                    type="text"
                                    name="username"
                                    id="username"
                                    class="focus:ring-indigo-500 focus:border-indigo-500 flex-1 block w-full rounded-none rounded-r-md sm:text-sm border-gray-300"
                                    placeholder="username"
                                    value="{{user.username}}"
                                />
                            </div>
                        </div>
                        <div class="">
                            <label
                                for="email"
                                class="block text-sm font-medium text-gray-700"
                            >
                                Email
                            </label>
                            <div class="mt-1 flex rounded-md shadow-sm">
                                <input
                                    type="email"
                                    name="email"
                                    id="email"
                                    class="focus:ring-indigo-500 focus:border-indigo-500 flex-1 block w-full rounded-md sm:text-sm border-gray-300"
                                    placeholder="mail@example.com"
                                    value="{{user.email}}"
                                />
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label
                                for="first_name"
                                class="block text-sm font-medium text-gray-700"
                            >
                                First Name
                            </label>
                            <div class="mt-1">
                                <input
                                    type="text"
                                    id="first_name"
                                    name="first_name"
                                    class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border border-gray-300 rounded-md"
                                    placeholder="First Name"
                                    value="{{user.first_name}}"
                                />
                            </div>
                        </div>
                        <div>
                            <label
                                for="first_name"
                                class="block text-sm font-medium text-gray-700"
                            >
                                Last Name
                            </label>
                            <div class="mt-1">
                                <input
                                    type="text"
                                    id="last_name"
                                    name="last_name"
                                    class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border border-gray-300 rounded-md"
                                    placeholder="Last Name"
                                    value="{{user.last_name}}"
                                />
                            </div>
                        </div>
                    </div>

                    {% if user_errors %}
                    <div>
                        {% for error in user_errors %}
                        <p class="text-red-500 text-xs italic">{{error}}</p>
                        {% endfor %}
                    </div>
                    {% endif %}

                    <div class="flex justify-end">
                        <button
                            type="submit"
                            class="bg-orange-600 hover:bg-secondary px-4 py-2 rounded-md shadow-md text-sm font-bold text-white"
                        >
                            Update
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="bg-white shadow px-4 py-5 sm:rounded-lg sm:p-6">
        <div class="md:grid md:grid-cols-3 md:gap-6">
            <div class="md:col-span-1">
                <h3 class="text-lg font-medium leading-6 text-gray-900">
                    Personal Information
                </h3>
                <p class="mt-1 text-sm text-gray-500">
                    Use a permanent address where you can receive mail.
                </p>
            </div>
            <div class="mt-5 md:mt-0 md:col-span-2">
                <form method="POST" enctype="multipart/form-data">
                    {% csrf_token %} {% csrf_token %}
                    <input
                        type="text"
                        name="action"
                        value="updateProfile"
                        hidden
                    />
                    <div class="grid grid-cols-6 gap-6">
                        <div class="col-span-6 sm:col-span-3">
                            <label
                                for="phone"
                                class="block text-sm font-medium text-gray-700"
                                >Phone Number</label
                            >
                            <div class="mt-1 flex rounded-md shadow-sm">
                                <span
                                    class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 text-sm"
                                >
                                    +88
                                </span>
                                <input
                                    type="text"
                                    name="phone"
                                    id="phone"
                                    class="focus:ring-indigo-500 focus:border-indigo-500 flex-1 block w-full rounded-none rounded-r-md sm:text-sm border-gray-300"
                                    placeholder="01700000000"
                                    value="{{user.profile.phone}}"
                                    pattern="[0-9]{11}"
                                    title="11 digit phone number"
                                />
                            </div>
                        </div>

                        <div class="col-span-6 sm:col-span-3">
                            <label
                                for="nid"
                                class="block text-sm font-medium text-gray-700"
                                >Your NID Number</label
                            >
                            <input
                                type="text"
                                name="nid"
                                id="nid"
                                class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"
                                pattern="[0-9]{10}"
                                title="10 digit NID number"
                                placeholder="1234567890"
                                value="{{user.profile.nid}}"
                            />
                        </div>

                        <div class="col-span-6">
                            <label
                                for="street-address"
                                class="block text-sm font-medium text-gray-700"
                                >Street address</label
                            >
                            <input
                                type="text"
                                name="address"
                                id="address"
                                autocomplete="street-address"
                                class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"
                                placeholder="123 Main St."
                                value="{{user.profile.address}}"
                            />
                        </div>

                        <div class="col-span-6">
                            <label
                                class="block text-sm font-medium text-gray-700"
                            >
                                Photo
                            </label>
                            <div class="mt-1 flex items-center space-x-5">
                                <span
                                    class="inline-block h-12 w-12 rounded-full overflow-hidden bg-gray-100 border-2 border-secondary"
                                >
                                    <!-- <svg
                                        class="h-full w-full text-gray-300"
                                        fill="currentColor"
                                        viewBox="0 0 24 24"
                                    >
                                        <path
                                            d="M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z"
                                        />
                                    </svg> -->
                                    <img
                                        src="{% if user.profile.image %}/media/{{user.profile.image}}{% else %}{% static 'profile/profilepictureplaceholder.jpg' %}{% endif %}"
                                        alt="Profile Photo"
                                        class="h-full w-full text-gray-300"
                                    />
                                </span>

                                <input
                                    type="file"
                                    accept="image/*"
                                    name="image"
                                    class="bg-white px-3 border border-gray-300 rounded-md shadow-sm text-sm leading-4 font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
                                    onchange="changeprofilepictureplaceholder()"
                                />
                                <button
                                    onclick="resetImageInput()"
                                    type="button"
                                    class="ml-2 text-sm text-gray-500 hover:text-gray-700 focus:outline-none"
                                >
                                    Reset
                                </button>
                            </div>
                        </div>
                        {% if profile_errors %}
                        <div class="col-span-6">
                            {% for error in profile_errors %}
                            <p class="text-red-500 text-xs italic">{{error}}</p>
                            {% endfor %}
                        </div>
                        {% endif %}
                        <div class="col-span-6 flex justify-end">
                            <button
                                type="submit"
                                class="bg-orange-600 hover:bg-secondary px-4 py-2 rounded-md shadow-md text-sm font-bold text-white"
                            >
                                Update
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
    function resetImageInput() {
        const inputFile = document.querySelector(
            'input[type="file"][name="image"]'
        );
        if (inputFile) {
            inputFile.value = ""; // Reset the value of the file input
        }
        document.querySelector('img[alt="Profile Photo"]').src =
            "{% if user.profile.image %}/media/{{user.profile.image}}{% else %}{% static 'profile/profilepictureplaceholder.jpg' %}{% endif %}";
    }

    function changeprofilepictureplaceholder() {
        const inputFile = document.querySelector(
            'input[type="file"][name="image"]'
        );
        if (inputFile.files && inputFile.files[0]) {
            const reader = new FileReader();

            reader.onload = function (e) {
                document.querySelector('img[alt="Profile Photo"]').src =
                    e.target.result;
            };

            reader.readAsDataURL(inputFile.files[0]); // convert to base64 string
        }
    }
</script>
{% endblock %}
